<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Question 3</title>
    <style type="text/css">
      .code {
        font-family: monospace;
      }
      .button {
        background-color: black;
        color: white;
        padding: 3px;
        cursor: pointer;
      }
      .gray {
        color: gray;
      }
      .green {
        color: green;
      }
      .red {
        color: red;
      }
    </style>
  </head>
  <body style="font-family: Garamond;">
    <h1>HTTP Headers and Cookies</h1>
    <ul>
      <li>
        Headers are small pieces of information sent along with the
        request/response.
      </li>
      <li>
        The are usually used by the server to identify the client, so that it
        can serve a resource appropriately.
      </li>
      <li>A client machine sends them along with the request.</li>
      <li>
        A server also sends back headers along with the response, to indicate
        information regarding the processing of the request.
      </li>
      <li>
        For example,
        <a href="https://www.blender.org/download/">Blender</a> shows a
        different download button on the Downloads page, depending on your
        operating system. The information about your operating system is stored
        in a header called as <span class="code">'User-Agent'</span>.
      </li>
      <li>
        Many websites use Cookies (small pieces of information which can help a
        server remember your preferences) which is also a header.
      </li>
      <li>
        On the server side, there is a
        <span class="code">'Set-Cookie'</span> header, which is sent back with a
        response. This tells the browser to store some data on the client
        machine.
      </li>
      <li>
        On the client side, the stored data is send back to the server with all
        subsequent requests, through a header called as
        <span class="code">'Cookie'</span>
      </li>
      <li>
        This question does not involve cookies, since all requests made are
        cross-origin, and cookies make sense only for webpage requests or
        same-origin requests.
      </li>
    </ul>
    <h2>Question:</h2>
    <h4>
      Write code for a backend server which responds to a POST request on
      <span>'/hungry/pizza'.</span>
    </h4>
    <h4>
      The request will contain a header with the name
      <span class="code">'pizza'</span>. The header will have a value of some
      random pizza dish.
    </h4>
    <h4>
      In response to the request, the server must set a header in the response
      with the name <span class="code">'order'</span>.
    </h4>
    <h4>
      The header must contain today's date, followed by the first 5 letters of
      the name of the pizza.
    </h4>
    <h4>
      For example: if today's date is <span class="code">7th April 2021</span>,
      and the pizza name is <span class="code">'Wisconsin 6 Cheese'</span>, then
      the server must set the header <span class="code">'order'</span> with the
      value of <span class="code">'07042021Wisco'</span>.
    </h4>

    <h4>
      You might a CORS error here due to the unconventional header 'pizza'.
      There is a fix for that as well, you might have to read MDN Web Docs to
      get it working right. You need to both allow this header, and expose your
      header (the used to set the cookie) on your backend.
    </h4>

    <form>
      Server address
      <input type="text" name="" id="address" />
    </form>
    <div>
      <span class="button" onclick="check()">Submit</span>
    </div>

    <h2 id="tasklist">Objectives Checklist:</h2>
    <ul>
      <li id="o1" class="gray">
        Get order header on pizza request on /hungry/pizza
      </li>
    </ul>

    <script type="text/javascript">
      async function check() {
        document.querySelector("#tasklist").innerHTML =
          "Objectives Checklist: Running";
        document.querySelector("#o1").classList.remove("red");
        document.querySelector("#o1").classList.remove("green");
        document.querySelector("#o1").classList.add("gray");
        const address = document.querySelector("#address").value;

        const pizzaList = [
          "Wisconsin 6 Cheese",
          "Pacific Veggie",
          "Fiery Hawaaiian",
          "Ultimate Pepperoni",
          "Veggie Paradise",
          "Mexican Green Wave",
          "Middle Eastern Supreme",
          "Classic Margherita",
        ];

        let randomPizza =
          pizzaList[Math.floor(Math.random() * pizzaList.length)];

        try {
          let res = await fetch(address + "/hungry/pizza", {
            method: "GET",
            headers: {
              pizza: randomPizza,
            },
          });

          let answer = getsolution(randomPizza);
          document.querySelector("#o1").classList.remove("gray");

          if (res.headers.get("order") === answer) {
            document.querySelector("#o1").classList.add("green");
          } else {
            document.querySelector("#o1").classList.add("red");
            console.log("Order did not match requirements");
          }
        } catch (err) {
          console.log(err);
          document.querySelector("#o1").classList.add("red");
        }
        document.querySelector("#tasklist").innerHTML =
          "Objectives Checklist: Finished running";
      }

      function getsolution(pizza) {
        let fives = pizza.substr(0, 5);
        let a = new Date();
        let date = a.getDate().toString();
        date = date.length === 2 ? date : "0" + date;
        let month = (a.getMonth() + 1).toString();
        month = month.length === 2 ? month : "0" + month;
        let year = a.getUTCFullYear().toString();
        // console.log(date + month + year + fives);
        return date + month + year + fives;
      }
    </script>
  </body>
</html>
